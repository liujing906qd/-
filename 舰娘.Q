[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=19
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=c0ac3c71-3249-4d6f-ae63-2f2425773c90
Description=舰娘
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
UEsDBBQAAgAIAKBFPkYdpX3lxRUAAAhOAQAJABEAVUlQYWNrYWdlVVQNAAecRMtUnETLVJxEy1TtXQl8VNXVPy/sW9iEArKDCigISdgXDSFIIEBMArIIIUCASEhiElYFEWVRRBZFrSvuS61iVerWWr/Pqq21ta7ULp+2tbXaBdu6fF8LfP8z84YZstQ5753kZOJcfv/fnQwz99wz777z/v977n2vEQXL6z9r//6dj3X7gCqVCdSIjh1vQU0j3ksAnNAf7YJ/NwaOHT9+PPT2ZuB4vMRMOQrwMUwB+Fg3AZoBLYHmQAugFdAGaA0kBg89tQXaAx2AjkAn4BSgM9AF+AbQFTgV6AZ0B3oCPYBeQB+gN9AX6A/0A04DzgBOBwYAZwIDgUHAWcAQYDBwNjAMGAokAcOBZGAEsAIYBYwERgNjgTHAuMCYJhoPnAOkAucCE4F0IA2YBEwGpgDnARnANGAqkAnMAKYDM4HzgSwgG5gF5AC5wGxgDnABMBeYD8wDLgQWAguAPCAfWAQsBgqAJcBSYBlQCCwHLgJuBYqAlcAqoAQoBkqBcuBioAyoANYAq4G1wHpgHbABuBS4BNgIXAZsAi4Hrgj0vwT/KnAs0tFuBdpaT5LSGSMmNJacr/jswXlZO3qMe91pxHGiIPjeLPzKQ8l7aU6OE7K/robP7GkdtBuyH/l/aThqmT560DLCfpOvsB+qI/8vF793KUbADIyIVVQgtt+BEgL227pxN9rvNXZrjt1W6O3Ggb7u+d/fjQGWffq6YXJJ2Sofpx/5/b5D/orf7/stTxz8yYfDDO0fOXLE1/e9xp1w/Es4ie9Fe8xC8YevOvm4ChZ57EMi4h/zk2aC+JcQYX82rrblgNcetIP91hTmvNF8p1GE/WxYzceVfyZ+hyLhtTcU/5tSkK9Fa79xhP1c2F8XYA+ej78jPf5NXHBJA/soAso89uQUD/abRvgftj8Rx2FJgGcJ7QeOZwvB79+s0vFf4vP3Z27eXGC/OQU5fGRZgJPiU4q98nn1PgcuC9NzeufkF5f3zikoK1xWS/Zz8xenlRRXlJUUef5+XlpJmecA7Pf6Nw+RpwzxpyCgIuQl0UP8bxEx/jNx7snPupPHf6LbXrT2W0bYnwz7xf7OP7H/fL0a575ORfQphNorDlyFi73EP7H91ifFP9Y/w3z47zh8PWXe3rGGz4R0z4Hk2tE/PUl2/W3jjgEuFvyHx2tz97UG/+F5li6C8d+WdPlPN+Hv3450+Q/PO7UX+N+eVPmP+PhHzpdq8Z9+Av87RPhvrZ/8Fr/6hwvPgTL/+czDd631q1/+o8F/ee63l2D8dSRd/stzzD0E9k+hMP+14D+dSJf/dHfP6WjtdyZb/sO5gRD/yYDtAlyByz3abw3/2Z8+Av+7RBz/HFgvcsdgQWAGXlY6ePC/K0Vef/jqHzr3wmdjtKUb/Offs7/A/24R9hOo+TOvvv7i84ffeanxW4fe/oLquPiN3xrx37J08Pl9Hstt0ybmpc/JSp+UkZsxc0ZegMx3xnupuam5adPypmfk5OD9zPTZ6ZzFCnz8xHvB8VfueQR29zD+T40Yfzk479Z7Zr+B819sv3uV8688cBUodBVYPlAYiItfXXp7sN+jGvtTYJt14AphLO7swX5POnn+K+hzIWqOgLKI3BPxpzcFczjR2meucJ8Tss/6M8nz+I/Mvw2o4TMh3Vlb+pNtDxf4z/ntkP6z0J+cY2/jvnZjQqtAuMhNRbhIoaohJfBeh4iQkpp1Ipy057dn5c4MfzzQL7ybMysrK3Nuysl/Jp/8Z9LJfwZiV9PM1InpmSnhl8nhl0mVeptc6e/K/x9osI3bxez0rNSM7Gr8O/GtSMdC3wq2VM23ArYTA92q9otBl/7zsUhbUbBk5cSSdV6PP5taXVGSs7q0tGi9h+9rzD/wuoxBgvE/gFTnH8TjfyDpzj/w6Bks8H8Q6edfUgT2eV1NC/d1rOdf333r0KPfefqpL8cY2ffLP1m78PnDAWCSh+8n+Oy/1vxTsmD8nUW6+bfT3TajtT+YdOcfhrrnVLT2h5Dt/MPZpDv/wNfYMwT+DyXb+Qfu77gT429FYASs9KT+g/Pf/HsOFPifRFXjf7Yn9u8t/5NMevO/1vnXWJ+/VuJ/qRUV+Uu8nMUW+jslYvxZ5D+HU+X8Z7KP+OM4HMt5ze/oGj5TF/pzsiD+8DppS/3Ja7ND+lNDf/B67rEC/0eRrf4YTbr6g9euTxD4P4b04n994P+Pf/7sF1b2Nfj/gxTk/88b9F9Lf6YLxt/YiPijpT8mCeyPI139wfFsvMD+eNLVH6muT9Han0C2+uMc0tUfvIdnlMD/c8lWf4SOV3D8+dcf7M8Ygf8TKc7/60tR4v/ZBaX5hV7OYAv9mUa2+b9JZKs/0qmy/kjxEX/C+a+pNXymLvTHBYL4w1rFUn/w3k5N/cH7QDMF/k8hW/2RQQ2L/7/yycvHrOxr8H8+d/gC4GUjXSOf/dfQn7zveaZg/E8l/fzXbIH9aaSvP2YJ7GeSrv7geDJDYH866eqPbLfNaO3PIFv9MZN09Qfv/c8Q+J9FtvqD710Q0h9x/m9bMvMXFxT5/X7e9PzSzII1XhrS0J88nqYJxn822ea/cshWf+SSrf6YRZX1x3Af8cdxmE/zfVfm1/CZutAfBYLxx1whtP/YQn8w30t0X2voD76XzAKB/3Mijr/fYh1/nzz82nN3P2Nn3y//5+vidmA3cIOH77f32X+N/X98D6PlgvE3l3TzX3xvpUUC+/PI9v4HHCdD91XT0h/LBP5fSLr6g49nnsD+AtLVH3zvrIUC+wvJVn/kka7+WOqO6WjtL6KGM/9vXVT4e5Jd/y30J/MVy/sfLKbI+F+G/hTjGliKukzchy4e7C+hSP6/GvZKoEMKaYM3/iu2v5Qq8/8RPo5/OP9QUxSrC/6/WhD/2Iol/+dYGLr+a/B/vgfkKoH/y0n3/g985VwrsL+CdPkfx99Sgf1CsuV/F5E+/1sj8H8l1Z/7Pzx9+PkHYlm/8Zot1m8fkTf91sln//0ePw3+z+dTiWD8FZEu/+edqsUC+6vIlv8Xky7/r3BjSrT2S8g2/8Cx2pL/XUy2/K+MbPlfeYT9uH5T0G/Jdv33H/+Z/4/0cf47DquH/6PgPcarK3XB/7cK4h+f35b8n7WKJv/ne7lvFPi/hnT5/xYKcqBo7a8lXf7P97ffLLC/jmz5/3rS5//bBP5vIL38T0PIvxykYP7Fy/6Lrj773xDu/8bj+TLB+LuEdPk/P8dik8D+pWTL/zeSLv+/0j2no7W/iWz5P48VS/6/mWz5/+Vky/+3UP14/kcc9qAYLxr7ZwJ75/NsnuJhPf8a1H+jfMT/cP5nZw2fqQv9d5Pg+sd8wXL/CV+vW7mvNfTfXtS7BP5vJdv9J9tIV//tR71H4P920td/Nwrs7yD9/Qc3COxfFeH/k++98ez37jr0plX88avfeiKa3I+6wvGm31r67H+sr5/R0H88nnYLxt/VpKv/rkN9rcD+TrLVf9eQrv673v1No7W/i2z1Hx8rzf3v+9zfNFr7u8l2/8Eest1/sJcazvMfVPI3KXb9t/79LeZf9lHl9WejfcQfx2E+xffQubWGz9SF/rhPEH/4emWZf+LrhWb+6S7Utwv830+6+ae7UT8gsH8D6eqP21DfKbB/I9nmn26KOP4NYf0V528+Im/8v4fP/jcc/u9Pf94vGP/fJN39JzejPiCwfzPp6o97UN8hsH8L2eqPW0lXf9zr+hSt/dvIVn/wtcoy/3QH2eafDpBe/t93/NG5/1X6utKCpYUVhSXFwu83hPvf+Hluk0X+8U6q+vzRoR773zoi//BwTeO9Dvj/04L4x3zZMv/AfDm0b1iD/38H9SMC/+8h2/zDvaTL/w+hfkzg/32kz/+fEti/n/TzD98V2H+AdPnfQxTUANHaf5B0+d8TqB8V2H+IbPnft0jv+q9x/7PNFFyT6WX/TKw/f5WM+6/B/590x1S04+9hsuX/3ybd/MPjbpvR2n+EbPMPj5Jt/uEg2d7/6DGqyj+HefbfcXg+4z3gezV8pi74548F44/5WnOqH0Vv/ZbNJhzz+x+998pRP+s3LPQHx0vN9U//TcG532jtP0G2+uNJ0tUfL6P+L4H/h0hff/xIYP+7pK8/XhHYf4p09cezqF8Q2H+adPXHD1H/QGD/GQrrD7/FL/9/yl2/lZjgLX/T2mf/v+7830J/Pku6+YeXUD8nGP/Pka3+YJ6oqT9eRP19gf/fJ1v98TzZ6o8fkK3+eIGq6o8kz/6H579/WsNn/pP+sC5pJasWl/jl//kV4P/TC8vLC0uKPd4H2WuJ9fVzGvrzF27siXb8M1e1zH+wXujsvtbQH2+hfp2ij78vku76p7eFv/8PSVd//Az1mwL/XyJ9/XFYYD9y35uW/pD8/i+Trv74Ceo3BP6/EmHf7xbAjymYz0j0uP+im8/4Zc3fm5AzzElykp0Ux9NN1I/7PAB+58809Oc7qH8u8OVHZJv/+jHp6o93Ub8m8P9VstUfHC9C+iMDtgtwBS73aN8L/36Nwro9B9aL3DHoRQF5WX/yU6rKv5M9++84fDw/AX5dw2fqYv7/Y8H44+u1Jf9irqQ5//s71P8j8P/nZDv/+wbp8q8/ov6twP83I8f/ifyJzU2o7fMnh47F8v7Xle786Qse+ZcW//6TYPy9Rfrz/x8J7L9Nuvz7l6g/ENh/h3Tn/z9E/b7A/rtky78Oky7/+gPqXwn8/wXZ8i9eK6A5//t71L8R+P/LCP9b+Yxf8efH2Ra/86cW8/+/Itv5/1+T7fz/b6iq/kjx7H94/v+vNXymtvXH/5Js/pG5uqX+eB9o677W0B//RH2Eoo+/H5Du/O9nwt//t3QS/7dJnLgl1uOvxvwp3w+Q50+9rH/u4LP/Gvrzb6j/IRj/vyP9+f8vKXbm/39Puvrjz6j/LvD/Q9LVH5+j/lRg/w9kqz/+SLr6gzff/UXg/0dkqz9Yq9eX5z+b50/01h94fgazn+L3+FnM/39MtvP/n1BV/j3cs/9OYD3lGByIozV8prb5d3NHxv/4emHJv/9CYd6iwb8bsf+CWPBX0uXfjYW//99Id/7/GOoEJ3r/j1D92f/vlz/zveR4/QHvafEy/93ZZ/+tr59NI66fjofHOGrx72ZO7PDvT0mXf/+LD5jA/7+TLv9u4gRHTLT2/0G2/PufpMu/m8L3f1P0/n9Gtvyb9ZLl+osvAsctWCz415dUlX+N8Ox/eP6zdQ3BuC7WX3QVnH88X2rJv/hZXaG8j/X6s/D6A5ubcNqvP3j1Rcv1Bxr8u4MTnL+Mdiz9i2zX3/ybdPl3Z/jeXuD/UdKf/+wi4V+kv/7iGwL7x0mXf7WE7XYC+3zSa/KvU9BeW4F95oqW/CvBiT//J44g/K4/a5IQXH823+P+3TY+r1/x9Sf+iob+6gQnWgniXyPHVn/xfJ3m+quOaK+NwP8mju3+26aO7fqbZo7t+pvmTlX9OdKz/47TAu0NBHoY6c8Bwvln7q/W/X8U8mc2iTO3fN3Xn1jMPzBf19z/0Q/t9RLE31aObv6nv/D8a+3o6k9+BlZfgf9tHH39eUYMzf8nOrr681S010fgf1tl/Xka2ustsN8uQn9y/ozXn3H+zMv6s0Sf8SvW82f1YP40fO9zD88wtZh/aO/o5n9OR3vdBeO/g7H+6OjY5n94vsoy/9OpGv49yrP/4fzPWYb5n9GC8dfZsc3/8Fyt5vr3JLQ3ROB/F8d2/r+rMv8agfaGCfzvVgv8a5TA/qmK+s8+fxb7z6/dRMHn13rhXz199l+Lf48UjL/uyvx7ENobKrDfQ5l/p6C9swX2exrnf3op86/haO9Mgf+9jflXH+X532S0N1jgf1/j+d9+jt7zX+P7d/0VXf0nv4uNxfx/f+P5/9Oq0R+jPfvvOMznLgTGG+qPqYL4c7qx/jhDWX+kob1zBP4PMNYfA5X1x3lob6LA/0GO3vr/WH/+gd+icf9z5v98/3Mv/L+3z/5r6c8Mwfg709FffzZFYP8sZf0xFu2lCuwPVtYf6WjvXIH9Icb642xl/TGZ+bzA/6HG+mOYsv6YhPYmCPxPivP/elN0+b/8Hn4W+jPZeP1RirH+GF5FfySpPP92hqH+mC+IPyOM9cdIZf2Ri/ayBP6PMtYfoxsU/4/9+3cy/3/B4/x/L5/9P4oxswX1lcA2YCuwHbgK2AFcDewCdgLXUHC9yB5gN7AXuA7YB1xPwf7vB24E+JmINwE3A7cBtwC3U3DtzwHUd1DwOeD8LGp+HvY97v/d69bxUjdFY/5hDsZujiD+jamF/Oc8gf2xtaA/5wrsj1PWn5loL1tgf7yy/pyN9s4X2J9grD/PUdafF6C96QL/zzXWn6lO/bn/k98S13+R+k++h1pj/mEWDsJMwfifaJz/TDPWn5OM9Wd6NfrTz/OvpzGHBfK+Qn8enFd7+rNIMP4mG+vP85T1ZwHayxf4P6VB6T/b+ydo7J9l/TffY/6nj8/+W8w/ZCjnPwvR3lLB+J9aC/pjpcD+tFrQHxcJ7Gcq648FaG+JwP50Zf2xHO0tFtifYaw/ZirrjxVob6HA/6x4/qfeFAX+n7O6tLRovUcCZ6E/z1fOfy5De4sE4z/bWH/kGOuPXGP9Masa/aHx/OvSGoJBSHfUpv7YKBh/s431B89XtXRfa+iPNWivTOD/HOP811xl/rkB7a0W+D+vFvjnpQL78+P7f9SKX/3HvGgI8BzxtVhe+vrsv5b+uEQw/i5U1h/FTnD/VLT2Fyjrj3Vor1xgf6Gx/shT1h/r0V6JwP9FxvmPfGX+uRbtXSzwf7Ex/1wS13/1pqjpP48PsLbQH0uN9UdBNfrDx/O/aRXa2w1cbqg/rhXEn2XG+mO5sv7YjvauEPi/wlh/FCrrj51ob5vA/4vi+3/Uil/+zz8g83+eE/DC//v77L+W/twlGH8rayH/cY3AfpGy/rgM7W0V2F+lrD+uQntXCuwXG+uPEmX9cTXa2yzwv9RYf1ysrD92oL0tAv/L4vy/3hQ1/u9xAt1Cf5Yb5z8qjPXH6mr0h9/nfx9Am/sM9ccdgvizxlh/rFXWHzehvesF/q8z1h/r4/t/1Ipf/v84Bfl/C4/8v5/P/mvoz1vR9xsF439DLeS/bhfYv6QW9MdtAvuXKuuPPbx3TGB/o7L+uBnt7RfY32SsPy5T1h+3oL29Av83G+uPyyP0R209VyZeYqPE9Z9tUdN/HgWExvzDN3EQrhPEvy3G+c8rjPXnlcb6c2s1+nO4Z/+dE/bvNtSfBwXjb5ux/tyurD8fRHv3CvzfEd//o1b86r/pbv7nbo/67zSf/beYf7hKOf/5bbT3gGD8X10L+vNRgf2dtaA/HxHYv0ZZf96J9u4X2N+lrD+/hfbuE9i/1lh/7lbWnw+jvbsE/u+J53/ixS0W8w97lfOfD6G9ewTjf5+x/rjOWH9cb6w/9ivyTy5S+9ollu3/P1BLAQIXCxQAAgAIAKBFPkYdpX3lxRUAAAhOAQAJAAkAAAAAAAAAAAAAgAAAAABVSVBhY2thZ2VVVAUAB5xEy1RQSwUGAAAAAAEAAQBAAAAA/RUAAAAA


[Script]
Dimenv AutoSupply
Dimenv AutoRepair
Dimenv AutoExpedition
Dimenv AutoAttack

Dimenv SupplyNavyArray
Dimenv ExpeditionNavyArray 
Dimenv AutoAttackNavyArray

Event Form.CB_AutoSupply.Click
    AutoSupply = Form.CB_AutoSupply.Value
    Form.CB_Supply1.Value = Form.CB_AutoSupply.Value
    Form.CB_Supply2.Value = Form.CB_AutoSupply.Value
    Form.CB_Supply3.Value = Form.CB_AutoSupply.Value
    Form.CB_Supply4.Value = Form.CB_AutoSupply.Value
End Event
Event Form.CB_AutoRepair.Click
    AutoRepair = Form.CB_AutoRepair.Value
End Event
Event Form.CB_AutoExpedition.Click
    AutoExpedition = Form.CB_AutoExpedition.Value
End Event
Event Form.CB_AutoAttack.Click
    AutoAttack = Form.CB_AutoAttack.Value
End Event


/**********************************************************设置用户自定义变量**********************************************************/

//资源文件夹路径
Dim resourceFolder
resourceFolder = "C:\Users\LiuJing\Pictures\"

//远征地图下标
Dim ExpeditionMapIndex
ExpeditionMapIndex = 0
//远征任务下标
Dim ExpeditionMisstionIndex
ExpeditionMisstionIndex = 4

//出击地图下标
Dim AttackMapIndex
AttackMapIndex = 1
//出击任务下标X
Dim AttackMisstionXIndex
AttackMisstionXIndex = 1
//出击任务下标Y
Dim AttackMisstionYIndex
AttackMisstionYIndex = 0
Dim AttackNightFight
AttackNightFight = 1
Dim AttackFightRound
AttackFightRound = 3

//补给舰队下标最大值
Dim SupplyNavyMax
SupplyNavyMax = 1
/*****************************设置常量*****************************/
//远征地图坐标
Const ExpeditionMapPosition = "135|450"
Const ExpeditionMapPositionOffset = 55
//远征关卡坐标
Const ExpeditionMisstionPosition = "160|170"
Const ExpeditionMisstionPositionOffset = 30

//补给全选框坐标
Const SupplyCheckBoxAllPosition = "120|120"
//补给舰队坐标
Const SupplyNavyPosition = "150|120"
Const SupplyNavyPositionOffset = 30
//补给舰队确定
Const SupplyNavyConfirmPosition = "700|450"

//入渠空位坐标
Const RepairEmptyPosition = "250|170"
Const RepairEmptyPositionOffset = 80
//入渠类型坐标
Const RepairTypePosition = "780|110"
//入渠舰队坐标
Const RepairNavyPosition = "480|141"
Const RepairNavyPositionOffset = 30

//出击地图坐标
Const AttackMapPosition = "160|450"
Const AttackMapPositionOffset = 75
//出击任务坐标
Const AttackMisstionPosition = "280|200"
Const AttackMisstionPositionOffsetX = 350
Const AttackMisstionPositionOffsetY = 150
/**********************************************************初始化变量**********************************************************/
Dim X, Y
X = -1 
Y = - 1 
Dim ShipWasDestroyed
ShipWasDestroyed = 0





//**********************************************************逻辑**********************************************************/
/****************************初始化****************************/
Call GetHwndForGame()
/****************************远征结束*****************************/
Call GoToMuGang()
Call LJ_FindPic("远征_结束_开始")
If (FoundPic = 1) Then 
    Call LJ_FindPicUntilFoundThenClick("远征_结束_开始")
    Call LJ_FindPicUntilFoundThenClick("远征_结束_评价_继续")
    Call LJ_FindPicUntilFoundThenClick("远征_结束_评价_继续")
End If
/*****************************补给*****************************/
If (AutoSupply = 1) Then 
    Call GoToScene("补给")
    Call LJ_DeleyForNet()
    Call SupplyNavy()
End If
/*****************************入渠*****************************/
If (AutoRepair = 1) Then 
    Call GoToScene("入渠")
    Call LJ_DeleyForNet()
    Call RepairNavy()
End If
/*****************************远征*****************************/
If (AutoExpedition = 1) Then 
    Call GoToMuGang()
    Call LJ_FindPicUntilFoundThenClick("母港_出击")
    Delay 1000
    Call LJ_FindPicUntilFoundThenClick("出击_主界面_远征")
    Call LJ_DeleyForNet()
    Call SelectExpeditionMap()
    Call SelectExpeditionMisstion()
    Call LJ_FindPicUntilFoundThenClick("出击_确定任务")
    Call LJ_FindPicUntilFoundThenClick("出击_远征_远征开始")
    Call LJ_DeleyForNet()
    Call GoToMuGang()
End If
/****************************出击****************************/
If (AutoAttack = 1) Then 
    If (ShipWasDestroyed = 1) Then 
        MessageBox "舰船大破无法出击，脚本中止。请修理后在启动脚本"
        EndScript
    End If
    Call GoToMuGang()
    Call LJ_FindPicUntilFoundThenClick("母港_出击")
    Delay 1000
    Call LJ_FindPicUntilFoundThenClick("出击_主界面_出击")
    Call LJ_DeleyForNet()
    Call SelectAttackMap()
    Call SelectAttackMisstion()
    Call LJ_FindPicUntilFoundThenClick("出击_确定任务")
    Call LJ_FindPicUntilFoundThenClick("出击_出击_出击开始")
    Call Fighting()
    Call LJ_DeleyForNet()
End If
/*****************************补给*****************************/
If (AutoSupply = 1) Then 
    Call GoToScene("补给")
    Call LJ_DeleyForNet()
    Call SupplyNavy()
End If
/*****************************入渠*****************************/
If (AutoRepair = 1) Then 
    Call GoToScene("入渠")
    Call LJ_DeleyForNet()
    Call RepairNavy()
End If
/*****************************结束*****************************/
//Delay 600000










/**********************************************************函数**********************************************************/
/*进入母港 先查找是不是在母港界面 如果不是 则尝试找到并点击左边UI上的母港返回 点击后阻塞等待 直到找到或者超时*/
Function GoToMuGang()
    Call LJ_FindPic("母港_出击")
    If (FoundPic = 0)
        Call LJ_FindPicUntilFoundThenClick("左侧UI_母港")
        Call LJ_FindPicUntilFound("母港_出击")
    End If
End Function
Function GoToScene(SceneName)
    Call LJ_FindPic("左侧UI_" & SceneName)
    If (FoundPic = 0) Then 
        Call GoToMuGang()
        Call LJ_FindPicUntilFoundThenClick("母港_" & SceneName)
    Else 
        Call LJ_FindPicUntilFoundThenClick("左侧UI_" & SceneName)
    End If
End Function

/*选择远征地图*/
Function SelectExpeditionMap()
    Call LJ_PointAdd(ExpeditionMapPosition,ExpeditionMapIndex * ExpeditionMapPositionOffset,0)
    Call LJ_LeftClickOnXY()
End Function
/*选择远征关卡*/
Function SelectExpeditionMisstion()
    Call LJ_PointAdd(ExpeditionMisstionPosition,0,ExpeditionMisstionIndex * ExpeditionMisstionPositionOffset)
    Call LJ_LeftClickOnXY()
End Function

/*选择补给舰队*/
Function SupplyNavy()
    For index = 0 To SupplyNavyMax
        Call LJ_PointAddAndClick(SupplyNavyPosition,index * SupplyNavyPositionOffset,0)
        Call LJ_PointGetAndClick(SupplyCheckBoxAllPosition)
        Call LJ_FindPicAndClick("补给_补给列表_确定补给")
        Call LJ_DeleyForNet()
    Next
End Function

/*入渠*/
Function RepairNavy()
    Dim FlagShipIsRepayed
    FlagShipIsRepayed = 0
    Dim RepairedX, RepairedY
    RepairedX = 0
    RepairedY = 0
    For index = 0 To 3
        Call LJ_FindPicUntilFoundThenClick("入渠_维修列表_空位")
        
        //        Dim Timeout
        //        Timeout = 0
        //        Call LJ_FindPic("入渠_维修列表_类型_损坏程度")
        //        Do While (FoundPic = 0)
        //            Call LJ_PointGetAndClick(RepairTypePosition)
        //            Delay 100
        //            Call LJ_FindPic("入渠_维修列表_类型_损坏程度")
        //            Delay 100
        //            Timeout = Timeout + 100
        //            If (Timeout >= 5000) Then 
        //                Exit Function
        //            End If
        //        Loop
        //确定船只
        For index = 0 To 9
            Call LJ_FindPicByRect("入渠_维修列表_第一舰队附舰",RepairedX,RepairedY,800,480)
            If (FoundPic = 1) Then 
                RepairedX = X
                RepairedY = Y
                Call LJ_FindPicByRect("入渠_战斗状态_大破", RepairedX, RepairedY, 800,480)
                Call LJ_LeftClickOnXY()
                Call LJ_FindPicByRect("入渠_战斗状态_中破", RepairedX, RepairedY, 800,480)
                Call LJ_LeftClickOnXY()
                Call LJ_FindPicByRect("入渠_战斗状态_小破", RepairedX, RepairedY, 800,480)
                Call LJ_LeftClickOnXY()
                Call LJ_FindPicByRect("入渠_战斗状态_修复", RepairedX, RepairedY, 800,480)
                If (FoundPic = 1) Then 
                    RepairedX = RepairedX + 0
                    RepairedY = RepairedY + 25
                    Goto IsRepayed
                End If
            End If
            Call LJ_FindPicAndClick("入渠_维修列表_入渠开始")
            Call LJ_FindPicAndClick("入渠_维修列表_维修开始_确定维修")
            Call LJ_FindPicAndClick("入渠_维修列表_空位_详情返回")
            Call LJ_FindPicAndClick("入渠_维修列表_空位_列表返回")
            Rem IsRepayed
        Next
    Next
    Call GoToMuGang()
End Function

/*选择出击地图*/
Function SelectAttackMap()
    Call LJ_PointAdd(AttackMapPosition,AttackMapIndex * AttackMapPositionOffset,0)
    Call LJ_LeftClickOnXY()
End Function
/*选择出击关卡*/
Function SelectAttackMisstion()
    Call LJ_PointAdd(AttackMisstionPosition,AttackMisstionXIndex * AttackMisstionPositionOffsetX,AttackMisstionYIndex * AttackMisstionPositionOffsetY)
    Call LJ_LeftClickOnXY()
End Function

Function Fighting()
    FightingRound = 0
    Do
        Call LJ_FindPicAndClick ("战斗_战斗中_指南针")
        Call LJ_FindPicAndClick ("战斗_战斗中_阵形_复k阵")
        Call LJ_FindPicAndClick("战斗_战斗中_脱离判定_夜战")
        If (FightingRound < AttackFightRound) Then 
            Call LJ_FindPicAndClick("战斗_战斗中_回合结束_进击")
            If (FoundPic = 1) Then 
                FightingRound = FightingRound + 1	
            End If
        Else 
            Call LJ_FindPicAndClick("战斗_战斗中_回合结束_撤退")
        End If
        Call LJ_FindPicAndClick("战斗_结束_评价_战果报告")
        If (FoundPic = 1) Then 
            Call LJ_FindPicByRect("战斗_战斗中_战斗状态_大破", 0, 0, 400, 480)
            If (FoundPic = 1) Then 
                ShipWasDestroyed = 1
                FightingRound = 999//不在继续战斗
            End If
        End If
        Call LJ_FindPicAndClick("出击_结束_评价_返回")
        Call LJ_FindPic("母港_出击")
        Delay 1000
    Loop While (FoundPic = 0)
    //Call LJ_FindPicUntilFoundThenClick("出击_结束_评价_继续")
End Function










/**********************************************************工具函数**********************************************************/
/*获得游戏句柄*/
Function GetHwndForGame()
    Dim HwndTidu,HwndEmbedding,HwndDocObject
    HwndTidu = Plugin.Window.Find(0, "提督Iも忙しい！")
    HwndEmbedding = Plugin.Window.FIndex(hwndTidu, 0, "Shell Embedding", 0)
    HwndDocObject = Plugin.Window.FIndex(HwndEmbedding, 0, "Shell DocObject View", 0)
    hwnd = Plugin.Window.FIndex(HwndDocObject, 0, "Internet Explorer_Server", 0)
    If (hwnd = 0) Then 
        MessageBox "找不到窗口句柄，程序结束"
        EndScript
    End If
End Function
/**第三方库查找图片**/
Function LiebFindPic(picName)
    Call Plugin.BGCP2_02.FindPicture(hwnd, 0, 0, 800, 480, resourceFolder & picName & ".bmp", 50, 0.9, X, Y)
End Function
Function LiebFindPicByRect(picName,StartX,StartY,EndX,EndY)
    Call Plugin.BGCP2_02.FindPicture(hwnd, StartX ,StartY ,EndX ,EndY ,resourceFolder & picName & ".bmp", 50, 0.9, X, Y)
End Function

/**查找图片**/
Function LJ_FindPic(picName)
    Call LiebFindPic(picName)
    If X > - 1  Then //找到了	
        FoundPic = 1
    Else //没知道，可能是被选中的状态，更换选中状态的图片再找一次
        Call LiebFindPic(picName & "_touched")
        If X > - 1  Then 
            FoundPic = 1//找到了	
        Else 
            FoundPic = 0//真没找到
        End If
    End If
End Function
Function LJ_FindPicByRect(picName,StartX,StartY,EndX,EndY)
    Call LiebFindPicByRect(picName,StartX,StartY,EndX,EndY)
    If X > - 1  Then //找到了	
        FoundPic = 1
    Else //没知道，可能是被选中的状态，更换选中状态的图片再找一次
        Call LiebFindPic(picName & "_touched")
        If X > - 1  Then 
            FoundPic = 1//找到了	
        Else 
            FoundPic = 0//真没找到
        End If
    End If
End Function

/**查找图片，找到就点没找到就算了**/
Function LJ_FindPicAndClick(picName)
    Call LJ_FindPic(picName)
    If (FoundPic = 1) Then 
        Call LJ_LeftClickOnXY()
    End If
End Function

/**查找图片，直到超时**/
Function LJ_FindPicUntilFound(picName)
    Dim Timeout
    Timeout = 0
    Do
        Call LJ_FindPic(picName)
        Delay 100
        Timeout = Timeout + 100
        If (Timeout >= 5000) Then 
            Exit Function
        End If
    Loop While (FoundPic = 0)
End Function

/**查找图片，直到超时或者图片位置点击**/
Function LJ_FindPicUntilFoundThenClick(picName)
    Call LJ_FindPicUntilFound(picName)
    Call LJ_LeftClickOnXY()
End Function

/**点击XY的位置**/
Function LJ_LeftClickOnXY()
    If X <= - 1  Then 
        Exit Function
    End If
    Call Plugin.Bkgnd.LeftClick(hwnd, X, Y)
    X = -1 
    Y = - 1 
    Delay 1000
End Function

/**存储坐标给某个变量**/
Function LJ_PointSet(positionX, positionY)
    LJ_PointSet = positionX & "|" & positionY
End Function

/**获得坐标从某个变量**/
Function LJ_PointGet(XY)
    Dim zb
    ZB = InStr(XY, "|")
    X = Clng(Left(XY, ZB - 1)) : Y = Clng(Right(XY, Len(XY) - ZB))
End Function

/**获得坐标从某个变量，然后单击**/
Function LJ_PointGetAndClick(XY)
    LJ_PointGet (XY)
    
    Call LJ_LeftClickOnXY()
End Function

/**某个变量与坐标相加**/
Function LJ_PointAdd(XY,positionX,positionY)
    Call LJ_PointGet(XY)
    X = X + positionX
    Y = Y + positionY
End Function
/**某个变量与坐标相加，然后单击**/
Function LJ_PointAddAndClick(XY,positionX,positionY)
    Call LJ_PointAdd(XY,positionX,positionY)
    Call LJ_LeftClickOnXY()
End Function

Function LJ_DeleyForNet()
    Delay 5000
End Function
